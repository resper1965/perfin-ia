/**
 * Improved Pentest Results Grid with enhanced visualizations
 */
'use client'

import { motion } from 'framer-motion'
import { Shield, AlertTriangle, AlertCircle, Info, CheckCircle2 } from 'lucide-react'
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { cn } from '@/lib/utils'

interface PentestResult {
  nome: string
  vulnerabilidades: {
    critico: number
    alto: number
    medio: number
    baixo: number
    info: number
  }
}

interface ImprovedPentestGridProps {
  applications: PentestResult[]
  className?: string
}

const severityConfig = {
  critico: {
    label: 'Crítico',
    variant: 'critical' as const,
    icon: AlertTriangle,
    color: 'text-purple-400',
    bg: 'bg-purple-500/10'
  },
  alto: {
    label: 'Alto',
    variant: 'danger' as const,
    icon: AlertCircle,
    color: 'text-red-400',
    bg: 'bg-red-500/10'
  },
  medio: {
    label: 'Médio',
    variant: 'warning' as const,
    icon: AlertCircle,
    color: 'text-yellow-400',
    bg: 'bg-yellow-500/10'
  },
  baixo: {
    label: 'Baixo',
    variant: 'info' as const,
    icon: Info,
    color: 'text-blue-400',
    bg: 'bg-blue-500/10'
  },
  info: {
    label: 'Info',
    variant: 'secondary' as const,
    icon: CheckCircle2,
    color: 'text-slate-400',
    bg: 'bg-slate-500/10'
  },
}

export function ImprovedPentestGrid({ applications, className = '' }: ImprovedPentestGridProps) {
  return (
    <div className={cn("grid md:grid-cols-2 lg:grid-cols-4 gap-4", className)}>
      {applications.map((app, index) => {
        const total = Object.values(app.vulnerabilidades).reduce((a, b) => a + b, 0)
        const hasHighSeverity = app.vulnerabilidades.critico > 0 || app.vulnerabilidades.alto > 0

        return (
          <motion.div
            key={app.nome}
            initial={{ opacity: 0, scale: 0.9 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ delay: index * 0.06, duration: 0.3 }}
          >
            <Card className={cn(
              "bg-slate-850/50 border-slate-800 hover:border-primary/30 transition-all duration-300 h-full",
              hasHighSeverity && "border-red-500/30"
            )}>
              <CardHeader>
                <div className="flex items-center justify-between mb-2">
                  <Shield className="w-5 h-5 text-primary" />
                  {hasHighSeverity && (
                    <Badge variant="danger" size="sm">
                      Atenção
                    </Badge>
                  )}
                </div>

                <CardTitle className="text-slate-100 text-sm">
                  {app.nome}
                </CardTitle>

                <CardDescription>
                  <div className="flex items-baseline gap-1 mt-2">
                    <span className="text-xl font-bold text-primary">{total}</span>
                    <span className="text-xs text-slate-500">vulnerabilidades</span>
                  </div>
                </CardDescription>
              </CardHeader>

              <CardContent>
                <div className="space-y-2.5">
                  {(Object.entries(app.vulnerabilidades) as [keyof typeof severityConfig, number][]).map(([severity, count]) => {
                    if (count === 0) return null
                    const config = severityConfig[severity]
                    const Icon = config.icon

                    return (
                      <div
                        key={severity}
                        className={cn(
                          "flex items-center justify-between p-2 rounded-lg transition-colors",
                          config.bg
                        )}
                      >
                        <div className="flex items-center gap-2">
                          <Icon className={cn("w-3.5 h-3.5", config.color)} />
                          <span className="text-xs text-slate-300">{config.label}</span>
                        </div>
                        <Badge variant={config.variant} size="sm">
                          {count}
                        </Badge>
                      </div>
                    )
                  })}

                  {total === 0 && (
                    <div className="flex items-center gap-2 p-2 rounded-lg bg-green-500/10">
                      <CheckCircle2 className="w-3.5 h-3.5 text-green-400" />
                      <span className="text-xs text-green-300">Nenhuma vulnerabilidade</span>
                    </div>
                  )}
                </div>
              </CardContent>
            </Card>
          </motion.div>
        )
      })}
    </div>
  )
}
